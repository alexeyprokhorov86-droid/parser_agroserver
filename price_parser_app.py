"""
–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ü–µ–Ω —Å Agroserver.ru
Streamlit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
"""

import streamlit as st
import pandas as pd
from datetime import datetime
import time
from agroserver_parser import AgroserverParser
import os

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–ü–∞—Ä—Å–µ—Ä —Ü–µ–Ω Agroserver",
    page_icon="üí∞",
    layout="wide"
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session state
if 'parse_results' not in st.session_state:
    st.session_state.parse_results = None
if 'last_update' not in st.session_state:
    st.session_state.last_update = None

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üí∞ –ü–∞—Ä—Å–µ—Ä —Ü–µ–Ω Agroserver.ru")
st.markdown("### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã (–ú–æ—Å–∫–≤–∞/–ú–û)")

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
with st.sidebar:
    st.header("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    
    # –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    csv_path = st.text_input(
        "–ü—É—Ç—å –∫ –±–∞–∑–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤:",
        value="ingredients_v2.csv",
        help="–§–∞–π–ª —Å –≤–∞—à–∏–º–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏"
    )
    
    st.divider()
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    if st.session_state.last_update:
        st.success(f"‚úÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:\n{st.session_state.last_update}")
    else:
        st.info("‚ÑπÔ∏è –¶–µ–Ω—ã –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å")
    
    st.divider()
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    if os.path.exists(csv_path):
        df = pd.read_csv(csv_path, encoding='utf-8')
        st.markdown("**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã:**")
        st.metric("–í—Å–µ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤", len(df))
        st.metric("–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞", f"{df['–°—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±/–∫–≥'].mean():.2f} ‚ÇΩ/–∫–≥")

# –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
tab1, tab2, tab3 = st.tabs(["üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω", "üìã –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞", "üìö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"])

# ============================================================================
# –í–ö–õ–ê–î–ö–ê 1: –û–ë–ù–û–í–õ–ï–ù–ò–ï –¶–ï–ù –í –ë–ê–ó–ï
# ============================================================================

with tab1:
    st.header("–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –≤ –±–∞–∑–µ")
    
    st.markdown("""
    –≠—Ç–æ—Ç —Ä–µ–∂–∏–º –æ–±–Ω–æ–≤–∏—Ç —Ü–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –º–∞–ø–ø–∏–Ω–≥–µ.
    
    **‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:**
    - –ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-15 –º–∏–Ω—É—Ç
    - –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞
    - –¶–µ–Ω—ã –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    """)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    if not os.path.exists(csv_path):
        st.error(f"‚ùå –§–∞–π–ª {csv_path} –Ω–µ –Ω–∞–π–¥–µ–Ω! –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.")
    else:
        # –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞
        if st.button("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω", type="primary", use_container_width=True):
            
            # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            progress_bar = st.progress(0)
            status_text = st.empty()
            
            try:
                # –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Å–µ—Ä
                parser = AgroserverParser()
                
                # –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑—É
                df_ingredients = pd.read_csv(csv_path, encoding='utf-8')
                
                # –ú–∞–ø–ø–∏–Ω–≥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                ingredient_mapping = {
                    '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è –≤/—Å': '/muka-pshenichnaya/',
                    '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è 1 —Å': '/muka-pshenichnaya/',
                    '–°–∞—Ö–∞—Ä': '/sakhar/',
                    '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ 82,5%': '/maslo-slivochnoe/',
                    '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ 72,5%': '/maslo-slivochnoe/',
                }
                
                total_items = len(ingredient_mapping)
                updated_count = 0
                results_data = []
                
                # –ü–∞—Ä—Å–∏–º –∫–∞–∂–¥—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç
                for idx, (ingredient_name, category_url) in enumerate(ingredient_mapping.items()):
                    
                    # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    progress = (idx + 1) / total_items
                    progress_bar.progress(progress)
                    status_text.info(f"‚è≥ –ü–∞—Ä—Å–∏–Ω–≥: {ingredient_name} ({idx+1}/{total_items})")
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –≤ –±–∞–∑–µ
                    if ingredient_name not in df_ingredients['–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç'].values:
                        st.warning(f"‚ö†Ô∏è –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç '{ingredient_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
                        continue
                    
                    # –ü–∞—Ä—Å–∏–º
                    result = parser.parse_ingredient(ingredient_name, category_url)
                    
                    if result:
                        stats, df_prices = result
                        recommended_price = stats['—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è_—Ü–µ–Ω–∞']
                        
                        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É
                        mask = df_ingredients['–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç'] == ingredient_name
                        old_price = df_ingredients.loc[mask, '–°—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±/–∫–≥'].values[0]
                        
                        # –û–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ
                        df_ingredients.loc[mask, '–°—Ç–æ–∏–º–æ—Å—Ç—å, —Ä—É–±/–∫–≥'] = recommended_price
                        
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        change_percent = ((recommended_price - old_price) / old_price * 100) if old_price > 0 else 0
                        results_data.append({
                            '–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç': ingredient_name,
                            '–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞': f"{old_price:.2f} ‚ÇΩ",
                            '–ù–æ–≤–∞—è —Ü–µ–Ω–∞': f"{recommended_price:.2f} ‚ÇΩ",
                            '–ò–∑–º–µ–Ω–µ–Ω–∏–µ': f"{change_percent:+.1f}%",
                            '–ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π': stats['–Ω–∞–π–¥–µ–Ω–æ_–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π']
                        })
                        
                        updated_count += 1
                    
                    # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                    time.sleep(3)
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –±–∞–∑—É
                if updated_count > 0:
                    df_ingredients.to_csv(csv_path, index=False, encoding='utf-8')
                    
                    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    st.session_state.last_update = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                    
                    # –û—á–∏—â–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    progress_bar.empty()
                    status_text.empty()
                    
                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    st.success(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω: {updated_count}")
                    
                    # –¢–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                    if results_data:
                        st.markdown("### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:")
                        df_results = pd.DataFrame(results_data)
                        st.dataframe(df_results, use_container_width=True, hide_index=True)
                    
                    # –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                    st.rerun()
                else:
                    progress_bar.empty()
                    status_text.empty()
                    st.warning("‚ö†Ô∏è –¶–µ–Ω—ã –Ω–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã")
            
            except Exception as e:
                progress_bar.empty()
                status_text.empty()
                st.error(f"‚ùå –û—à–∏–±–∫–∞: {e}")
                st.exception(e)

# ============================================================================
# –í–ö–õ–ê–î–ö–ê 2: –ü–ê–†–°–ò–ù–ì –û–î–ù–û–ì–û –ò–ù–ì–†–ï–î–ò–ï–ù–¢–ê
# ============================================================================

with tab2:
    st.header("–ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞")
    
    col1, col2 = st.columns([2, 1])
    
    with col1:
        ingredient_name = st.text_input(
            "–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞:",
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è"
        )
    
    with col2:
        category_url = st.text_input(
            "URL –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ Agroserver:",
            placeholder="/muka-pshenichnaya/"
        )
    
    max_pages = st.slider("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:", 1, 5, 3)
    
    if st.button("üîç –ü–∞—Ä—Å–∏—Ç—å —Ü–µ–Ω—ã", type="primary", use_container_width=True):
        
        if not ingredient_name or not category_url:
            st.warning("‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è!")
        else:
            with st.spinner(f"–ü–∞—Ä—Å–∏–Ω–≥ —Ü–µ–Ω –Ω–∞ {ingredient_name}..."):
                try:
                    parser = AgroserverParser()
                    result = parser.parse_ingredient(ingredient_name, category_url)
                    
                    if result:
                        stats, df_prices = result
                        
                        st.success("‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!")
                        
                        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        st.markdown("### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ü–µ–Ω–∞–º:")
                        
                        metric_col1, metric_col2, metric_col3, metric_col4 = st.columns(4)
                        
                        with metric_col1:
                            st.metric("–ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π", stats['–Ω–∞–π–¥–µ–Ω–æ_–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π'])
                        
                        with metric_col2:
                            st.metric("–ú–∏–Ω. —Ü–µ–Ω–∞", f"{stats['–º–∏–Ω_—Ü–µ–Ω–∞']:.2f} ‚ÇΩ/–∫–≥")
                        
                        with metric_col3:
                            st.metric("–ú–∞–∫—Å. —Ü–µ–Ω–∞", f"{stats['–º–∞–∫—Å_—Ü–µ–Ω–∞']:.2f} ‚ÇΩ/–∫–≥")
                        
                        with metric_col4:
                            st.metric("üí∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è", f"{stats['—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è_—Ü–µ–Ω–∞']:.2f} ‚ÇΩ/–∫–≥")
                        
                        # –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
                        st.markdown("### üìã –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")
                        st.dataframe(
                            df_prices[['–Ω–∞–∑–≤–∞–Ω–∏–µ', '—Ü–µ–Ω–∞_—Ä—É–±_–∫–≥', '—Ä–µ–≥–∏–æ–Ω', '–ø–æ—Å—Ç–∞–≤—â–∏–∫']], 
                            use_container_width=True,
                            hide_index=True
                        )
                        
                        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        st.session_state.parse_results = stats
                    else:
                        st.error(f"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ü–µ–Ω—ã –¥–ª—è: {ingredient_name}")
                
                except Exception as e:
                    st.error(f"‚ùå –û—à–∏–±–∫–∞: {e}")
                    st.exception(e)

# ============================================================================
# –í–ö–õ–ê–î–ö–ê 3: –ò–ù–°–¢–†–£–ö–¶–ò–Ø
# ============================================================================

with tab3:
    st.header("üìö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é")
    
    st.markdown("""
    ## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä:
    
    ### üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
    
    1. **–ü–∞—Ä—Å–∏—Ç —Ü–µ–Ω—ã —Å Agroserver.ru**
       - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ú–æ—Å–∫–≤–µ –∏ –ú–û
       - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
       - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ä—É–±/—Ç ‚Üí —Ä—É–±/–∫–≥
    
    2. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ**
       - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–º–∏–Ω, –º–∞–∫—Å, —Å—Ä–µ–¥–Ω—è—è, –º–µ–¥–∏–∞–Ω–∞)
       - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ–¥–∏–∞–Ω—É –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é —Ü–µ–Ω—É
       - –§–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    
    3. **–û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–∑—É**
       - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –≤ CSV
       - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
       - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    
    ---
    
    ## üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
    
    ### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –±–∞–∑—ã
    
    1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω"
    2. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω"
    3. –ü–æ–¥–æ–∂–¥–∏ 5-15 –º–∏–Ω—É—Ç (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π —Å—Ç—Ä–∞–Ω–∏—Ü—É)
    4. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ
    
    ### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
    
    1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "üìã –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞"
    2. –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è")
    3. –í–≤–µ–¥–∏ URL –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "/muka-pshenichnaya/")
    4. –ù–∞–∂–º–∏ "–ü–∞—Ä—Å–∏—Ç—å —Ü–µ–Ω—ã"
    5. –ò–∑—É—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    
    ---
    
    ## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞:
    
    –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª `price_parser_app.py`:
    
    ```python
    ingredient_mapping = {
        '–ù–∞–∑–≤–∞–Ω–∏–µ –≤ –±–∞–∑–µ': '/url-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/',
        '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è –≤/—Å': '/muka-pshenichnaya/',
        '–°–∞—Ö–∞—Ä': '/sakhar/',
        # –î–æ–±–∞–≤—å —Å–≤–æ–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
    }
    ```
    
    ---
    
    ## üìç –ö–∞–∫ –Ω–∞–π—Ç–∏ URL –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
    
    1. –ó–∞–π–¥–∏ –Ω–∞ agroserver.ru
    2. –ù–∞–π–¥–∏ –Ω—É–∂–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
    3. –°–∫–æ–ø–∏—Ä—É–π —á–∞—Å—Ç—å URL –ø–æ—Å–ª–µ agroserver.ru
    
    **–ü—Ä–∏–º–µ—Ä—ã:**
    - `https://agroserver.ru/muka-pshenichnaya/` ‚Üí `/muka-pshenichnaya/`
    - `https://agroserver.ru/sakhar/` ‚Üí `/sakhar/`
    - `https://agroserver.ru/maslo-slivochnoe/` ‚Üí `/maslo-slivochnoe/`
    
    ---
    
    ## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
    
    1. **–ù–µ –ø–∞—Ä—Å–∏—Ç—å —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ**
       - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
       - –ú–∞–∫—Å–∏–º—É–º: 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å
    
    2. **–ë–∏—Ä–∂–µ–≤—ã–µ —Ü–µ–Ω—ã ‚â† —Ä–æ–∑–Ω–∏—á–Ω—ã–µ**
       - –¶–µ–Ω—ã –Ω–∞ Agroserver - —ç—Ç–æ –æ–ø—Ç
       - –¢–≤–æ–∏ –∑–∞–∫—É–ø–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Ä–æ–∂–µ –Ω–∞ 10-30%
    
    3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**
       - –ï—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
       - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
       - User-Agent –±—Ä–∞—É–∑–µ—Ä–∞
    
    4. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞**
       - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–¥–∏–∞–Ω–∞ (—É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –≤—ã–±—Ä–æ—Å–∞–º)
       - –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞, —á–µ–º —Å—Ä–µ–¥–Ω–µ–µ
    
    ---
    
    ## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
    
    ### –õ–æ–∫–∞–ª—å–Ω–æ:
    ```bash
    streamlit run price_parser_app.py
    ```
    
    ### –ù–∞ Streamlit Cloud:
    1. –ó–∞–≥—Ä—É–∑–∏ —Ñ–∞–π–ª—ã –≤ GitHub
    2. –ü–æ–¥–∫–ª—é—á–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Streamlit Cloud
    3. –£–∫–∞–∂–∏ main file: `price_parser_app.py`
    4. Deploy!
    
    ---
    
    ## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
    
    –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç—ã –ø–æ–ª—É—á–∏—à—å:
    - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã –≤ –±–∞–∑–µ
    - ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
    - ‚úÖ –î–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
    - ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ü–µ–Ω—ã
    
    ---
    
    **–ì–æ—Ç–æ–≤–æ! –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä—Å–µ—Ä –∏ —ç–∫–æ–Ω–æ–º—å –≤—Ä–µ–º—è üéâ**
    """)

# –§—É—Ç–µ—Ä
st.markdown("---")
st.markdown("*–ü–∞—Ä—Å–µ—Ä —Ü–µ–Ω Agroserver.ru - –ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è –ü—Ä–æ—Ö–æ—Ä–æ–≤–∞*")
